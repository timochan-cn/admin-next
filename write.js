import{T as P,E as R,M as T,P as U,S as V}from"./parse-button.js";import{T as k}from"./TelegramPlane.js";import{d as b,af as A,o as y,aV as D,f as E,r as n,L as M,g as N,h as t,b0 as r,a$ as w,b1 as W,x as $,b2 as C,F as I,I as H,b3 as q,b4 as L}from"./vendor.js";import{H as z}from"./rounded-button.js";import{U as O}from"./underline-input.js";import{u as Y,R as p,W as _,a as G,C as J,d as K}from"./index.js";import"./use-react.js";import"./props.js";import"./js-yaml.js";const oe=b(()=>{const j=A(),o=Y(J);y(async()=>{await o.fetch()});const S=()=>({categoryId:o.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],hide:!1,summary:"",allowComment:!0,id:void 0}),F=e=>{const u=q(a),i=Object.keys(u);for(const l in e)i.includes(l)&&(a[l]=e[l])},a=D(S()),s=E(()=>j.query.id),m=E(()=>o.get(a.categoryId)||o.data?.value?.[0]||{});y(async()=>{const e=s.value;if(e&&typeof e=="string"){const u=await p.api.posts(e).get();F(u.data)}});const g=n(!1),f=M(),x=N(),B=async()=>{const e={...a,categoryId:m.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!L(s.value))return;const u=s.value;await p.api.posts(u).put({data:e}),f.success("\u4FEE\u6539\u6210\u529F")}else await p.api.posts.post({data:e}),f.success("\u53D1\u5E03\u6210\u529F");x.push({name:K.ViewPost,hash:"|publish"})};return()=>t(G,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,t(U,{data:a,onHandleYamlParsedMeta:e=>{a.title=e.title??a.title,a.slug=e.slug??a.slug}}),t(z,{icon:t(k,null),onClick:B})),footerButtonElement:t(I,null,t("button",{onClick:()=>{g.value=!0}},t(H,null,t(V,null))))},t(T,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}}),t("div",{class:"text-gray-500 py-3"},t("label",{class:"prefix"},`${_}/${m.value.slug}/`),t(O,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}})),t(R,{loading:!!(s.value&&typeof a.id=="undefined"),onChange:e=>{a.text=e},text:a.text}),t(P,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},t(r,{label:"\u5206\u7C7B",required:!0,path:"category"},t(w,{placeholder:"\u8BF7\u9009\u62E9",value:m.value.id,onUpdateValue:e=>{a.categoryId=e},options:o.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]})),t(r,{label:"\u6807\u7B7E"},t(W,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const u=b({setup(){const i=n([]),l=n(!1),h=n(""),v=n();return y(async()=>{l.value=!0,v.value&&v.value.$el.querySelector("input").focus();const{data:c}=await p.api.categories.get({params:{type:"Tag"}});i.value=c.map(d=>({label:d.name+" ("+d.count+")",value:d.name,key:d.name})),l.value=!1}),()=>t(w,{ref:v,size:"small",value:h.value,clearable:!0,loading:l.value,filterable:!0,tag:!0,options:i.value,onUpdateValue:c=>{h.value=c,e(c)}})}});return t(u,null)}})),t(r,{label:"\u6982\u8981"},t($,{placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)})),t(r,{label:"\u9690\u85CF",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(C,{value:a.hide,onUpdateValue:e=>void(a.hide=e)})),t(r,{label:"\u7248\u6743\u6CE8\u660E",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(C,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)}))))});export{oe as default};
