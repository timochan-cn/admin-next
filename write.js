import{T as R,E as T,M as U,P as V,S as k}from"./parse-button.js";import{T as A}from"./TelegramPlane.js";import{d as b,af as D,o as v,aV as M,f as E,r as n,L as N,g as W,h as t,b0 as r,a$ as w,b1 as $,x as H,b2 as C,F as I,I as q,b3 as y,b4 as L}from"./vendor.js";import{H as z}from"./rounded-button.js";import{U as O}from"./underline-input.js";import{u as Y,R as d,W as _,a as G,C as J,d as K}from"./index.js";import"./use-react.js";import"./props.js";import"./js-yaml.js";const oe=b(()=>{const j=D(),l=Y(J);v(async()=>{await l.fetch()});const S=()=>({categoryId:l.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],hide:!1,summary:"",allowComment:!1,id:void 0}),F=e=>{const o=y(a),i=Object.keys(o);for(const u in e)i.includes(u)&&(a[u]=e[u])},a=M(S()),s=E(()=>j.query.id),x=E(()=>l.get(a.categoryId)||l.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const o=await d.api.posts(e).get();F(o.data)}});const p=n(!1),f=N(),B=W(),P=async()=>{if(s.value){if(!L(s.value))return;const e=s.value;await d.api.posts(e).put({data:{...y(a),summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null}}),f.success("\u4FEE\u6539\u6210\u529F")}else await d.api.posts.post({data:{...y(a),summary:a.summary.trim()==""?null:a.summary.trim()}}),f.success("\u53D1\u5E03\u6210\u529F");B.push({name:K.ViewPost,hash:"|publish"})};return()=>t(G,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,t(V,{data:a,onHandleYamlParsedMeta:e=>{a.title=e.title??a.title,a.slug=e.slug??a.slug}}),t(z,{icon:t(A,null),onClick:P})),footerButtonElement:t(I,null,t("button",{onClick:()=>{p.value=!0}},t(q,null,t(k,null))))},t(U,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}}),t("div",{class:"text-gray-500 py-3"},t("label",{class:"prefix"},`${_}/${x.value.slug}/`),t(O,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}})),t(T,{loading:!!(s.value&&typeof a.id=="undefined"),onChange:e=>{a.text=e},text:a.text}),t(R,{show:p.value,onUpdateShow:e=>{p.value=e},data:a},t(r,{label:"\u5206\u7C7B",required:!0,path:"category"},t(w,{placeholder:"\u8BF7\u9009\u62E9",value:a.categoryId,onUpdateValue:e=>{a.categoryId=e},options:l.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]})),t(r,{label:"\u6807\u7B7E"},t($,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const o=b({setup(){const i=n([]),u=n(!1),h=n(""),g=n();return v(async()=>{u.value=!0,g.value&&g.value.$el.querySelector("input").focus();const{data:c}=await d.api.categories.get({params:{type:"Tag"}});i.value=c.map(m=>({label:m.name+" ("+m.count+")",value:m.name,key:m.name})),u.value=!1}),()=>t(w,{ref:g,size:"small",value:h.value,clearable:!0,loading:u.value,filterable:!0,tag:!0,options:i.value,onUpdateValue:c=>{h.value=c,e(c)}})}});return t(o,null)}})),t(r,{label:"\u6982\u8981"},t(H,{placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)})),t(r,{label:"\u9690\u85CF",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(C,{value:a.hide,onUpdateValue:e=>void(a.hide=e)})),t(r,{label:"\u7248\u6743\u6CE8\u660E",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(C,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)}))))});export{oe as default};
