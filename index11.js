import{u as q,_ as N,U as R,e as B,R as m,g as P,a as z}from"./index.js";import{d as b,r as S,b5 as k,w as v,o as j,h as e,F as w,g as x,ag as O,c as E,aU as H,b as I,G as $,K as Y,L as V,b1 as G,b2 as y,y as h,a_ as K,b4 as W,bE as Q,bc as X,B as T,A as C,I as Z,aV as ee,bo as te,bp as M}from"./vendor.js";import{_ as ae}from"./CheckCircleOutlined.js";import{H as A}from"./rounded-button.js";import{u as D,d as ue,l as J}from"./js-yaml.js";import{C as ne}from"./index6.js";import{A as re}from"./Add12Filled.js";import{T as le}from"./index3.js";import{R as se}from"./relative-time.js";import{u as oe}from"./use-table.js";class ie{created;id}var d;(function(l){l.JSON="json",l.Text="text",l.YAML="yaml"})(d||(d={}));class ce extends ie{type=d.JSON;private=!0;raw="{}";name="";reference="root";comment;metatype}const de=b({props:{value:{type:String,required:!0},onChange:{type:Function,required:!0},language:{type:String,required:!0}},setup(l){const o=S();k(l.value);let r;v(()=>l.value,n=>{r&&n!=r.getValue()&&r.setValue(n)});const{isDark:a}=q(R);return v(()=>a.value,n=>{r.updateOptions({theme:n?"vs-dark":"vs"})}),j(()=>{N(()=>import("./editor.main.js").then(function(n){return n.e}),["editor.main.js","assets/editor.main.90c5c042.css"]).then(n=>{r=n.editor.create(o.value,{value:l.value,language:l.language,theme:a.value?"vs-dark":"vs",automaticLayout:!0,minimap:{enabled:!1},tabSize:2}),["onKeyDown","onDidPaste","onDidBlurEditorText"].forEach(i=>{r[i](()=>{const u=r.getValue();l.onChange(u)})})})}),v(()=>l.language,n=>{if(!r)return;const i=r.getModel();!i||N(()=>import("./editor.main.js").then(function(u){return u.e}),["editor.main.js","assets/editor.main.90c5c042.css"]).then(u=>{u.editor.setModelLanguage(i,n)})}),()=>e(w,null,e("div",{ref:o,class:"h-full w-full relative"},e(ne,{description:"Monaco \u4F53\u79EF\u8F83\u5927\u8010\u5FC3\u7B49\u5F85\u52A0\u8F7D\u5B8C\u6210..."})))}}),pe=b({setup(){const l=x(),o=O(),r=E(()=>o.query.id),a=S(new ce),n=H(r.value?{json:"",yaml:"",text:""}:{json:JSON.stringify({name:"hello world"},null,2),text:"",yaml:"name: hello world"});v(()=>a.value.type,t=>{a.value.raw=n[t]}),v(()=>[n.json,n.yaml],I(([t,s],[g,p])=>{const c=t!==g,U=s!==p,_=k(n);try{c?_.yaml=ue(JSON.parse(t)):U&&(_.json=JSON.stringify(J(s),null,2))}catch{}},100)),v(()=>r,async t=>{if(t.value){const s=await m.api.snippets(t.value).get();switch(s.type){case d.JSON:{s.raw=JSON.stringify(JSON.parse(s.raw),null,2);break}}a.value=s,n[s.type]=s.raw}},{immediate:!0});const i=B(),u=$(),f=async()=>{const t=c=>{try{return JSON.stringify(JSON.parse(c),null,0)}catch{u.error("JSON \u683C\u5F0F\u9519\u8BEF")}},s=()=>{const c=n[a.value.type];switch(a.value.type){case d.JSON:return t(c);case d.YAML:{try{J(c)}catch{u.error("YAML \u683C\u5F0F\u9519\u8BEF")}return c}default:return c}},p={...Q(a.value,["_id","id","created","updated"]),raw:s()};p.metatype||delete p.metatype,r.value?await m.api.snippets(r.value).put({data:p}):await m.api.snippets.post({data:p}),u.success(`${r.value?"\u66F4\u65B0":"\u521B\u5EFA"}\u6210\u529F`),l.replace({query:{...o.query,tab:0}})};return D(()=>(i.setHeaderButton(e(A,{variant:"success",onClick:f,icon:e(ae,null)})),()=>{i.setHeaderButton(null)})),()=>e(w,null,e(Y,{cols:"36 1:12 1024:36 1600:36"},e(V,{span:12},e(G,null,e(y,{label:"\u540D\u79F0",required:!0},e(h,{onUpdateValue:t=>void(a.value.name=t),value:a.value.name})),e(y,{label:"\u5F15\u7528",required:!0},e(h,{value:a.value.reference,onUpdateValue:t=>void(a.value.reference=t),defaultValue:"root"})),e(y,{label:"\u5143\u7C7B\u578B"},e(h,{value:a.value.metatype,onUpdateValue:t=>void(a.value.metatype=t)})),e(y,{label:"\u6570\u636E\u7C7B\u578B"},e(K,{value:a.value.type,defaultValue:d.JSON,onUpdateValue:t=>void(a.value.type=t),options:Object.entries(d).map(([t,s])=>({label:t,value:s}))})),e(y,{label:"\u516C\u5F00",labelPlacement:"left"},e("div",{class:"w-full flex justify-end"},e(W,{value:!a.value.private,onUpdateValue:t=>void(a.value.private=!t)}))),e(y,{label:"\u5907\u6CE8"},e(h,{resizable:!1,value:a.value.comment,onUpdateValue:t=>void(a.value.comment=t),type:"textarea",rows:4})))),e(V,{span:24,class:"ml-[40px]"},e(de,{language:a.value.type.toLowerCase(),value:n[a.value.type],onChange:t=>{n[a.value.type]=t}}))))}});var L={};Object.defineProperty(L,"__esModule",{value:!0});const F=X,me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ve=F.createVNode("path",{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1 1 56 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z",fill:"currentColor"},null,-1);var ye=L.default=F.defineComponent({name:"LockFilled",render:function(o,r){return F.openBlock(),F.createBlock("svg",me,[ve])}});const fe=b({setup(){j(async()=>{await r(1,20)});const l=B();D(()=>(l.setHeaderButton(e(A,{onClick:()=>{i.push({query:{tab:1}})},icon:e(re,null)})),()=>{l.setHeaderButton(null)}));const{data:o,fetchDataFn:r,loading:a,pager:n}=oe((u,f)=>async(t,s)=>{const g=await m.api.snippets.get({params:{page:t,size:s,select:"-raw"}});u.value=g.data,f.value=g.pagination}),i=x();return()=>e(w,null,e(le,{data:o,pager:n,columns:[{key:"name",title:"\u540D\u79F0",render(u){const f=u.name,t=u.private;return e(T,{align:"center"},e(C,{tag:"a",text:!0,href:m.endpoint+"/snippets/"+u.reference+"/"+u.name+(u.private?`?token=bearer%20${P()}`:""),target:"_blank",size:"tiny"},f),t&&e(Z,{class:"items-center flex "},e(ye,null)))}},{title:"\u7C7B\u578B",key:"type"},{title:"\u5F15\u7528",key:"reference"},{key:"comment",title:"\u5907\u6CE8",width:300,ellipsis:{tooltip:!0}},{title:"\u521B\u5EFA\u4E8E",key:"created",render(u){return e(se,{time:u.created})}},{title:"\u64CD\u4F5C",key:"id",fixed:"right",render(u){return e(T,null,e(C,{text:!0,size:"tiny",type:"primary",onClick:()=>{i.push({query:{tab:1,id:u.id}})}},"\u7F16\u8F91"),e(ee,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await m.api.snippets(u.id).delete(),message.success("\u5220\u9664\u6210\u529F"),await r(n.value.currentPage)}},{trigger:()=>e(C,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>e("span",{style:{maxWidth:"12rem"}},"\u786E\u5B9A\u8981\u5220\u9664 ",u.title," ?")}))}}],loading:a.value}))}});var Se=b({name:"SnippetView",setup(){const l=O(),o=x(),r=E(()=>l.query.tab||"0");return()=>e(z,null,e(te,{size:"medium",value:r.value,onUpdateValue:a=>{o.push({query:{tab:a}})}},e(M,{name:"0",tab:"\u5217\u8868"},e(fe,null)),e(M,{name:"1",tab:"\u7F16\u8F91"},e(pe,null))))}});export{Se as default};
