import{H as j}from"./rounded-button.js";import{E as I}from"./toggle.js";import{G as C,S as R}from"./index4.js";import{d as v,y as $,h as a,r as y,z as P,x as p,F,af as B,g as A,aV as k,f as G,o as N,b6 as S,b0 as i,b1 as V,b4 as q,bt as T,b3 as M}from"./vendor.js";import{u as H}from"./use-parse-payload.js";import{R as f,a as L,d as W}from"./index.js";import"./use-react.js";import"./TelegramPlane.js";import"./Add12Filled.js";import"./Delete16Regular.js";const w="https://api.github.com/",_=(l,s)=>fetch(`${w}repos/${l}/${s}`).then(r=>r.json()),z=(l,s)=>fetch(`${w}repos/${l}/${s}/readme`).then(r=>r.json()).catch(r=>null).then(r=>{if(r){const m=(()=>{const t=r.download_url.split("/"),u=t.pop(),c=t.pop();return`https://cdn.jsdelivr.net/gh/${l}/${s}@${c}/${u}`})();return fetch(m).then(t=>t.text())}return null}),K=v({props:{onData:{type:Function,required:!0},defaultValue:{type:String}},setup(l){const s=$(),r=()=>{const m=s.create({title:"\u4ECE Github \u89E3\u6790",content:()=>{const t=v({setup(){const u=y(l.defaultValue??""),c=y(!1),h=async()=>{c.value=!0;const o=u.value.replace(/\.git$/,"").replace(/^https?:\/\/github.com\//,""),[n,d]=o.split("/"),[g,b]=await Promise.all([_(n,d),z(n,d)]);l.onData(g,b),c.value=!1,requestAnimationFrame(()=>{m.destroy()})};return()=>a(F,null,a(p,{onKeydown:e=>{e.code==="Enter"&&h()},class:"my-4",value:u.value,placeholder:"\u5728\u6B64\u8F93\u5165\u9879\u76EE\u5730\u5740",onUpdateValue:e=>void(u.value=e)}),a("div",{class:"flex space-x-4 justify-end"},a(P,{type:"primary",round:!0,onClick:h,loading:c.value},"\u83B7\u53D6")))}});return a(t,null)}})};return()=>a(j,{color:"#25292E",icon:a(C,null),name:"\u4ECE GitHub \u83B7\u53D6",onClick:r})}}),re=v({setup(){const l=B(),s=A(),r=()=>({name:"",previewUrl:"",docUrl:"",projectUrl:"",images:[],description:"",avatar:"",text:"",id:void 0}),m=e=>H(t)(e),t=k(r()),u=G(()=>l.query.id);N(async()=>{const e=u.value;if(e&&typeof e=="string"){const n=(await f.api.projects(e).get({})).data;m(n)}});const c=async()=>{const e=()=>{try{if(!t.text||t.text.trim().length==0)throw"\u5185\u5BB9\u4E3A\u7A7A";return{...T(M(t),(o,n,d)=>(o[d]=typeof n=="undefined"?null:typeof n=="string"&&n.length==0?"":n,o)),text:t.text.trim()}}catch(o){throw message.error(o),o}};if(u.value){if(!q(u.value))return;const o=u.value;await f.api.projects(o).put({data:e()}),message.success("\u4FEE\u6539\u6210\u529F")}else await f.api.projects.post({data:e()}),message.success("\u53D1\u5E03\u6210\u529F");s.push({name:W.ListProject})},h=(e,o)=>{const{html_url:n,homepage:d,description:g}=e;Object.assign(t,{description:g,projectUrl:n,previewUrl:d,images:(x=>{const U=/(?<=!\[.*\]\()(.+)(?=\))/g,E=[];for(const D of x.matchAll(U))E.push(D[0]);return E})(o||""),name:e.name,text:o||""})};return()=>a(L,{actionsElement:a(F,null,a(K,{onData:h,defaultValue:t.projectUrl}),a(j,{variant:"primary",onClick:c,icon:a(R,null)}))},a(S,{labelWidth:"7rem",labelPlacement:"left",labelAlign:"left"},a(i,{label:"\u9879\u76EE\u540D\u79F0",required:!0},a(p,{autofocus:!0,placeholder:"",value:t.name,onInput:e=>void(t.name=e)})),a(i,{label:"\u6587\u6863\u5730\u5740"},a(p,{placeholder:"",value:t.docUrl,onInput:e=>void(t.docUrl=e)})),a(i,{label:"\u9884\u89C8\u5730\u5740"},a(p,{placeholder:"",value:t.previewUrl,onInput:e=>void(t.previewUrl=e)})),a(i,{label:"\u9879\u76EE\u5730\u5740"},a(p,{placeholder:"",value:t.projectUrl,onInput:e=>void(t.projectUrl=e)})),a(i,{label:"\u9879\u76EE\u63CF\u8FF0",required:!0},a(p,{placeholder:"",value:t.description,onInput:e=>void(t.description=e)})),a(i,{label:"\u9879\u76EE\u56FE\u6807"},a(p,{placeholder:"",value:t.avatar,onInput:e=>void(t.avatar=e)})),a(i,{label:"\u9884\u89C8\u56FE\u7247"},a(V,{round:!0,value:t.images,onUpdateValue:e=>void(t.images=e)})),a(i,{label:"\u6B63\u6587",required:!0},a("div",{class:"w-full"},a(I,{unSaveConfirm:!1,class:"h-80 w-full",loading:!!(u.value&&!t.id),onChange:e=>{t.text=e},text:t.text})))))}});export{re as default};
