import{H as b}from"./rounded-button.js";import{E as w}from"./toggle.js";import{G as x,S as U}from"./index4.js";import{d as f,y as D,h as a,r as E,z as C,x as p,F as j,af as R,g as $,aV as I,f as P,o as B,b6 as A,b0 as i,b1 as G,b4 as N,bt as S,b3 as V}from"./vendor.js";import{u as q}from"./use-parse-payload.js";import{R as g,a as T,d as k}from"./index.js";import"./use-react.js";import"./TelegramPlane.js";import"./Add12Filled.js";import"./Delete16Regular.js";const y="https://api.github.com/",H=(l,s)=>fetch(`${y}repos/${l}/${s}`).then(u=>u.json()),L=(l,s)=>fetch(`${y}repos/${l}/${s}/readme`).then(u=>u.json()).catch(u=>null).then(u=>{if(u){const m=(()=>{const t=u.download_url.split("/"),r=t.pop(),c=t.pop();return`https://cdn.jsdelivr.net/gh/${l}/${s}@${c}/${r}`})();return fetch(m).then(t=>t.text())}return null}),M=f({props:{onData:{type:Function,required:!0},defaultValue:{type:String}},setup(l){const s=D(),u=()=>{const m=s.create({title:"\u4ECE Github \u89E3\u6790",content:()=>{const t=f({setup(){const r=E(l.defaultValue??""),c=E(!1),h=async()=>{c.value=!0;const o=r.value.replace(/\.git$/,"").replace(/^https?:\/\/github.com\//,""),[n,d]=o.split("/"),[v,F]=await Promise.all([H(n,d),L(n,d)]);l.onData(v,F),c.value=!1,requestAnimationFrame(()=>{m.destroy()})};return()=>a(j,null,a(p,{onKeydown:e=>{e.code==="Enter"&&h()},class:"my-4",value:r.value,placeholder:"\u5728\u6B64\u8F93\u5165\u9879\u76EE\u5730\u5740",onUpdateValue:e=>void(r.value=e)}),a("div",{class:"flex space-x-4 justify-end"},a(C,{type:"primary",round:!0,onClick:h,loading:c.value},"\u83B7\u53D6")))}});return a(t,null)}})};return()=>a(b,{color:"#25292E",icon:a(x,null),name:"\u4ECE GitHub \u83B7\u53D6",onClick:u})}}),ee=f({setup(){const l=R(),s=$(),u=()=>({name:"",previewUrl:"",docUrl:"",projectUrl:"",images:[],description:"",avatar:"",text:"",id:void 0}),m=e=>q(t)(e),t=I(u()),r=P(()=>l.query.id);B(async()=>{const e=r.value;if(e&&typeof e=="string"){const n=(await g.api.projects(e).get({})).data;m(n)}});const c=async()=>{const e=()=>{try{if(!t.text||t.text.trim().length==0)throw"\u5185\u5BB9\u4E3A\u7A7A";return{...S(V(t),(o,n,d)=>(o[d]=typeof n=="undefined"?null:typeof n=="string"&&n.length==0?"":n,o)),text:t.text.trim()}}catch(o){throw message.error(o),o}};if(r.value){if(!N(r.value))return;const o=r.value;await g.api.projects(o).put({data:e()}),message.success("\u4FEE\u6539\u6210\u529F")}else await g.api.projects.post({data:e()}),message.success("\u53D1\u5E03\u6210\u529F");s.push({name:k.ListProject})},h=(e,o)=>{const{html_url:n,homepage:d,description:v}=e;Object.assign(t,{description:v,projectUrl:n,previewUrl:d,name:e.name,text:o||""})};return()=>a(T,{actionsElement:a(j,null,a(M,{onData:h,defaultValue:t.projectUrl}),a(b,{variant:"primary",onClick:c,icon:a(U,null)}))},a(A,{labelWidth:"7rem",labelPlacement:"left",labelAlign:"left"},a(i,{label:"\u9879\u76EE\u540D\u79F0",required:!0},a(p,{autofocus:!0,placeholder:"",value:t.name,onInput:e=>void(t.name=e)})),a(i,{label:"\u6587\u6863\u5730\u5740"},a(p,{placeholder:"",value:t.docUrl,onInput:e=>void(t.docUrl=e)})),a(i,{label:"\u9884\u89C8\u5730\u5740"},a(p,{placeholder:"",value:t.previewUrl,onInput:e=>void(t.previewUrl=e)})),a(i,{label:"\u9879\u76EE\u5730\u5740"},a(p,{placeholder:"",value:t.projectUrl,onInput:e=>void(t.projectUrl=e)})),a(i,{label:"\u9879\u76EE\u63CF\u8FF0",required:!0},a(p,{placeholder:"",value:t.description,onInput:e=>void(t.description=e)})),a(i,{label:"\u9879\u76EE\u56FE\u6807"},a(p,{placeholder:"",value:t.avatar,onInput:e=>void(t.avatar=e)})),a(i,{label:"\u9884\u89C8\u56FE\u7247"},a(G,{round:!0,value:t.images,onUpdateValue:e=>void(t.images=e)})),a(i,{label:"\u6B63\u6587",required:!0},a("div",{class:"w-full"},a(w,{unSaveConfirm:!1,class:"h-80 w-full",loading:!!(r.value&&!t.id),onChange:e=>{t.text=e},text:t.text})))))}});export{ee as default};
