import{T as E}from"./TrashSharp.js";import{d as l,j as f,aU as h,ah as g,K as F,y as C,h as t,A as B,z as d,aW as y,F as A}from"./vendor.js";import{H as p}from"./rounded-button.js";import{T}from"./index3.js";import{u as R}from"./use-table.js";import{R as s,a as _}from"./index.js";import{r as x}from"./index10.js";const z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},j=g("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.16 0-7.74 2.42-9.44 5.93c-.32.67.04 1.47.75 1.71c.59.2 1.23-.08 1.5-.64c1.3-2.66 4.03-4.5 7.19-4.5c1.95 0 3.73.72 5.12 1.88l-1.91 1.91c-.63.63-.19 1.71.7 1.71H21c.55 0 1-.45 1-1V9.41c0-.89-1.08-1.34-1.71-.71l-1.89 1.9z",fill:"currentColor"},null,-1);var N=l({name:"RedoRound",render:function(o,c){return f(),h("svg",z,[j])}});const U={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},H=g("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L3.71 8.71C3.08 8.08 2 8.52 2 9.41V15c0 .55.45 1 1 1h5.59c.89 0 1.34-1.08.71-1.71l-1.91-1.91c1.39-1.16 3.16-1.88 5.12-1.88c3.16 0 5.89 1.84 7.19 4.5c.27.56.91.84 1.5.64c.71-.23 1.07-1.04.75-1.72C20.23 10.42 16.65 8 12.5 8z",fill:"currentColor"},null,-1);var K=l({name:"UndoRound",render:function(o,c){return f(),h("svg",U,[H])}}),L=l(()=>{const{checkedRowKeys:i,data:o,fetchDataFn:c}=R(e=>async()=>{const n=(await s.api.backups.get()).data;n.sort((u,r)=>r.filename.localeCompare(u.filename)),e.value=n});F(()=>{c()});const k=C(),v=async()=>{const e=message.info("\u5907\u4EFD\u4E2D",{duration:1e9,closable:!0}),a=await s.api.backups.new.get({responseType:"blob",timeout:1e9});e.destroy(),message.success("\u5907\u4EFD\u5B8C\u6210"),x(a,"backup.zip")},w=async()=>{const e=document.createElement("input");e.type="file",e.style.cssText="position: absolute; opacity: 0; z-index: -9999;top: 0; left: 0",e.accept=".zip",document.body.append(e),e.click(),e.onchange=()=>{const a=e.files[0],n=new FormData;n.append("file",a),s.api.backups.rollback.post({data:n,timeout:1<<30}).then(()=>{message.success("\u6062\u590D\u6210\u529F, \u9875\u9762\u5C06\u4F1A\u91CD\u8F7D"),setTimeout(()=>{location.reload()},1e3)})}},m=async e=>{let a="";if(Array.isArray(e)?a=e.join(","):a=e,await s.api.backups.delete({params:{files:a}}),message.success("\u5220\u9664\u6210\u529F"),Array.isArray(e))e.forEach(n=>{const u=o.value.findIndex(r=>r.filename===n);u!=-1&&o.value.splice(u,1)});else{const n=o.value.findIndex(u=>u.filename===e);n!=-1&&o.value.splice(n,1)}},b=async e=>{await s.api.backups.rollback(e).patch({}),message.info("\u56DE\u6EDA\u4E2D",{closable:!0,duration:1e9})},D=async e=>{const a=message.info("\u4E0B\u8F7D\u4E2D",{duration:1e9,closable:!0}),n=await s.api.backups(e).get({responseType:"blob",timeout:1e9});a.destroy(),message.success("\u4E0B\u8F7D\u5B8C\u6210"),x(n,e+".zip")};return()=>t(_,{actionsElement:t(A,null,t(p,{icon:t(K,null),name:"\u7ACB\u5373\u5907\u4EFD",variant:"primary",onClick:v}),t(p,{icon:t(N,null),onClick:w,name:"\u4E0A\u4F20\u6062\u590D",variant:"info"}),t(p,{icon:t(E,null),name:"\u6279\u91CF\u5220\u9664",variant:"error",disabled:!i.value.length,onClick:()=>{k.warning({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u591A\u4E2A\u5907\u4EFD\uFF1F",positiveText:"\u8FBE\u54A9",negativeText:"\u786E\u5B9A",onNegativeClick:async()=>{m(i.value)}})}}))},t(T,{data:o,fetchDataFn:c,checkedRowKey:"filename",nTableProps:{maxHeight:"calc(100vh - 17rem)"},onUpdateCheckedRowKeys:e=>{i.value=e},maxWidth:500,columns:[{type:"selection",options:["none","all"]},{title:"\u65E5\u671F",key:"filename"},{title:"\u5927\u5C0F",key:"size",width:200},{title:"\u64CD\u4F5C",fixed:"right",key:"filename",render(e){const a=e.filename;return t(B,{inline:!0},t(d,{text:!0,size:"tiny",type:"primary",onClick:()=>void D(a)},"\u4E0B\u8F7D"),t(y,{positiveText:"\u53D6\u6D88",negativeText:"\u56DE\u9000",onNegativeClick:()=>{b(a)}},{trigger:()=>t(d,{text:!0,size:"tiny",type:"warning"},"\u56DE\u9000"),default:()=>t("span",{style:{maxWidth:"12rem"}},"\u786E\u5B9A\u8981\u56DE\u9000?")}),t(y,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{m(a)}},{trigger:()=>t(d,{text:!0,size:"tiny",type:"error"},"\u79FB\u9664"),default:()=>t("span",{style:{maxWidth:"12rem"}},"\u786E\u5B9A\u8981\u5220\u9664?")}))}}],noPagination:!0}))});export{L as default};
